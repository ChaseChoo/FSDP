<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EasyATM ‚Äî PayNow</title>

  <!-- ATM Homepage UI Styles -->
  <link rel="stylesheet" href="styles/home.css">

  <!-- PayNow form styles -->
  <link rel="stylesheet" href="styles.css">

  <!-- Impersonation Guard Styles -->
  <link rel="stylesheet" href="impersonation-guard.css">

  <!-- Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="atm-body">

<main class="atm-shell">
  <section class="atm-card">
    <div class="atm-layout">

      <!-- ========================================= -->
      <!-- LEFT SIDE: PayNow Form                    -->
      <!-- ========================================= -->
      <div class="atm-left">

        <!-- Header -->
        <div class="atm-header">
          <div class="header-content">
            <div>
              <h1 class="atm-title">PayNow Transfer</h1>
            </div>
            <button onclick="location.href='index.html'" class="logout-btn">
              <i data-lucide="arrow-left"></i> Back
            </button>
          </div>
        </div>
        <!-- PayNow Form (Your EXACT functionality preserved) -->
        <div class="card">
          <form action="confirm-paynow.html" method="get" aria-describedby="before-send">

            <div class="grid-2">
              <div class="row">
                <label for="method">PayNow Method</label>
                <select id="method" name="method">
                  <option>Mobile Number</option>
                </select>
              </div>

              <div class="row">
                <label for="recipient">Recipient</label>
                <input id="recipient" name="recipient" type="tel" 
                       inputmode="numeric" pattern="\d*" 
                       class="numeric-only" required
                       placeholder="e.g., 91234567" />
                <div class="hint">Digits only. Safe Mode limits to approved contacts.</div>
              </div>
            </div>

            <div class="grid-2">
              <div class="row">
                <label for="amount">Amount (SGD)</label>
                <input id="amount" name="amount" type="number" 
                       inputmode="numeric" min="1" class="numeric-only"
                       placeholder="Enter amount" required />

                <div class="chips">
                  <span class="chip" data-amt="10">$10</span>
                  <span class="chip" data-amt="20">$20</span>
                  <span class="chip" data-amt="50">$50</span>
                  <span class="chip" data-amt="100">$100</span>
                </div>
              </div>
            </div>

            <div id="before-send" class="summary">
              <strong>Before you send:</strong> You will confirm the recipient on the next screen.
            </div>

            <!-- Impersonation Guard Status -->
            <div class="impersonation-guard-panel">
              <div class="guard-header">
                <div class="guard-status">
                  <span id="mic-status-indicator" class="status-badge status-inactive">
                    üé§ Monitoring Inactive
                  </span>
                  <span class="guard-subtitle">Impersonation Guard‚Ñ¢</span>
                </div>
                <button type="button" id="toggle-impersonation-guard" class="guard-toggle-btn guard-enable">
                  Enable
                </button>
              </div>
              <div class="guard-info">
                üõ°Ô∏è Detects scam phrases and blocks suspicious transactions
              </div>
            </div>

            <div class="actions">
              <button type="reset" class="btn btn-ghost">Clear</button>
              <button type="submit" class="btn btn-primary btn-lg">Continue</button>
            </div>
          </form>
        </div>

      </div>

      <!-- ========================================= -->
      <!-- RIGHT SIDE: Chatbot                       -->
      <!-- ========================================= -->
      <aside class="atm-right">

        <div class="topbar">
  <div class="top-right-controls">

    <select class="lang-select">
      <option>English</option>
    </select>

    <div class="divider"></div>

    <!-- ‚úÖ COMPACT SAFE MODE -->
    <div class="safe safe-compact" role="group" aria-label="Safe Mode">
      <input id="safemode" type="checkbox" aria-label="Enable Safe Mode" checked />
      <label for="safemode">Safe Mode</label>
    </div>

    <div class="divider"></div>

    <button onclick="location.href='home.html'" class="exit-btn hover-tts">
      <i data-lucide="log-out" class="icon"></i>
      <span>Exit</span>
    </button>

  </div>
</div>


        <div class="chat-shell">
          <div id="chatlog" class="chat-log"></div>
          <div class="chat-input-row">
            <input id="userInput" class="chat-input" placeholder="How can I assist?" />
            <button id="sendBtn" class="chat-send hover-tts">
              <i data-lucide="send" class="icon-xs"></i>
            </button>
          </div>
          <div class="chat-footer">
            <div class="chat-tip">Tip: ‚ÄúPayNow 50 to 91234567‚Äù</div>
          </div>
        </div>

      </aside>

    </div>
  </section>
</main>
<script>
  lucide.createIcons();
</script>


<script src="scripts/home.js"></script>
<script src="app.js"></script>
<script src="fraud-detection-system.js"></script>
<script src="impersonation-guard.js"></script>


<script>
(function () {
  function enforceDigits(el) {
    if (!el) return;
    el.addEventListener('input', function () {
      el.value = el.value.replace(/\D+/g, '');
    });
    el.addEventListener('paste', function (e) {
      e.preventDefault();
      let txt = (e.clipboardData || window.clipboardData).getData('text') || '';
      el.value = (el.value + txt.replace(/\D+/g, ''));
    });
  }

  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.numeric-only').forEach(enforceDigits);
    
    // Initialize Impersonation Guard toggle button
    const toggleBtn = document.getElementById('toggle-impersonation-guard');
    const statusBadge = document.getElementById('mic-status-indicator');
    let isEnabled = false;
    
    if (toggleBtn && window.ImpersonationGuard) {
      toggleBtn.addEventListener('click', function() {
        if (!isEnabled) {
          // Start monitoring
          window.ImpersonationGuard.startMonitoring();
          toggleBtn.textContent = 'Disable';
          toggleBtn.classList.remove('guard-enable');
          toggleBtn.classList.add('guard-disable');
          isEnabled = true;
        } else {
          // Stop monitoring
          window.ImpersonationGuard.stopMonitoring();
          toggleBtn.textContent = 'Enable';
          toggleBtn.classList.remove('guard-disable');
          toggleBtn.classList.add('guard-enable');
          isEnabled = false;
        }
      });
      
      // Check transaction lock status before form submission
      const form = document.querySelector('form');
      if (form) {
        form.addEventListener('submit', function(e) {
          if (window.ImpersonationGuard && window.ImpersonationGuard.isLocked()) {
            e.preventDefault();
            e.stopImmediatePropagation();
            alert('‚ö†Ô∏è Transaction is locked due to suspicious activity. Please verify your PIN to proceed.');
            return false;
          }
        }, true); // Use capture phase to run before fraud-detection-system.js
      }
    }
  });
})();
</script>

</body>
</html>
