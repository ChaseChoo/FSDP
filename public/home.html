<!DOCTYPE html>
<html class="light" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>OCBC ATM Main Transaction Menu - AI Assistant</title>

<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#ea2a33",
                        "background-light": "#f8f6f6",
                        "background-dark": "#211111",
                    },
                    fontFamily: {
                        "display": ["Public Sans", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
<style type="text/tailwindcss">
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            font-size: 32px;
        }
        .transaction-card:hover {
            border-color: #ea2a33;
            transform: translateY(-2px);
            transition: all 0.2s ease;
        }
        .chat-bubble-ai {
            @apply bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-2xl rounded-tl-none p-4 text-sm shadow-sm;
        }
        .chat-suggestion {
            @apply text-xs font-semibold text-primary bg-primary/5 border border-primary/20 px-3 py-2 rounded-full hover:bg-primary/10 transition-colors text-left w-full;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-[#1b0e0e] dark:text-white min-h-screen flex flex-col">
<header class="w-full bg-white dark:bg-zinc-900 border-b border-[#f3e7e8] dark:border-zinc-800 px-6 lg:px-12 py-4 sticky top-0 z-50">
<div class="max-w-[1400px] mx-auto flex items-center justify-between">
<div class="flex items-center gap-3">
<img src="sources/logo_ocbc.png" alt="OCBC Logo" class="h-8">
</div>
<div class="flex items-center gap-3">
<button id="exitBtn" class="bg-primary text-white px-6 py-2 rounded-lg font-bold text-sm flex items-center gap-2 hover:bg-red-700 transition-colors">
<span class="material-symbols-outlined !text-lg">logout</span>
                Exit
            </button>
</div>
</div>
</header>
<main class="flex-1 flex flex-row max-w-[1400px] mx-auto w-full px-6 py-8 gap-8 overflow-hidden">
<div class="flex-1 flex flex-col overflow-y-auto pr-2">
<div class="mb-8">
<h1 class="text-3xl md:text-4xl font-extrabold mb-2 text-[#1b0e0e] dark:text-zinc-100">What would you like to do today?</h1>
<p class="text-zinc-500 dark:text-zinc-400 font-medium">Please select a transaction to continue</p>
</div>
<div class="grid grid-cols-1 lg:grid-cols-2 gap-5 w-full h-[350px]">
<div class="col-span-1 flex flex-col gap-5">
<button id="btnGetCash" class="transaction-card group relative flex flex-col items-center justify-center p-6 bg-white dark:bg-zinc-900 rounded-xl border-2 border-transparent shadow-sm hover:shadow-xl flex-1">
<div class="bg-primary/10 group-hover:bg-primary/20 p-4 rounded-full mb-3 transition-colors">
<span class="material-symbols-outlined text-primary">payments</span>
</div>
<h3 class="text-lg font-bold mb-1">Get Cash</h3>
<p class="text-xs text-zinc-500 font-medium">Quick withdrawal</p>
</button>
<button id="btnDepositCash" class="transaction-card group relative flex flex-col items-center justify-center p-6 bg-white dark:bg-zinc-900 rounded-xl border-2 border-transparent shadow-sm hover:shadow-xl flex-1">
<div class="bg-primary/10 group-hover:bg-primary/20 p-4 rounded-full mb-3 transition-colors">
<span class="material-symbols-outlined text-primary">account_balance</span>
</div>
<h3 class="text-lg font-bold mb-1">Deposit Cash</h3>
<p class="text-xs text-zinc-500 font-medium">Deposit funds</p>
</button>
</div>
<button id="btnOtherServices" class="transaction-card group relative flex flex-col items-center justify-center p-6 bg-white dark:bg-zinc-900 rounded-xl border-2 border-transparent shadow-sm hover:shadow-xl col-span-1">
<div class="bg-primary/10 group-hover:bg-primary/20 p-4 rounded-full mb-3 transition-colors">
<span class="material-symbols-outlined text-primary">apps</span>
</div>
<h3 class="text-lg font-bold mb-1">Non-Cash Services</h3>
<p class="text-xs text-zinc-500 font-medium">Transfer, Bill Payment, Balance Inquiry, Card Services &amp; More</p>
</button>
</div>
<div class="w-full mt-16 mb-4">
<h3 class="text-base font-bold px-2 flex items-center gap-2">
<span class="w-1 h-5 bg-primary rounded-full"></span>
                More Options
            </h3>
</div>
<div class="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full">
<button class="flex items-center gap-4 bg-white/50 dark:bg-zinc-900/50 border border-zinc-200 dark:border-zinc-800 p-4 rounded-xl hover:bg-white dark:hover:bg-zinc-800 transition-all">
<div class="bg-zinc-100 dark:bg-zinc-800 p-2 rounded-lg">
<span class="material-symbols-outlined !text-xl text-zinc-600 dark:text-zinc-300">translate</span>
</div>
<span class="font-bold text-sm">Change Language</span>
</button>
<button class="flex items-center gap-4 bg-primary/5 border border-primary/20 p-4 rounded-xl hover:bg-primary/10 transition-all group">
<div class="bg-primary/20 p-2 rounded-lg group-hover:bg-primary/30">
<span class="material-symbols-outlined !text-xl text-primary">support_agent</span>
</div>
<span class="font-bold text-sm text-primary">Live Assistance</span>
</button>
</div>
</div>
<aside class="w-full max-w-[360px] flex flex-col bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl shadow-lg overflow-hidden shrink-0">
<div class="bg-primary p-5 flex items-center gap-3">
<div class="bg-white/20 p-2 rounded-lg">
<span class="material-symbols-outlined text-white !text-2xl">smart_toy</span>
</div>
<div>
<h3 class="text-white font-bold text-base leading-none">OCBC AI Assistant</h3>
<span class="text-white/70 text-xs font-medium">Online &amp; Ready to Help</span>
</div>
</div>
<div class="flex-1 overflow-y-auto p-4 flex flex-col gap-4 bg-zinc-50 dark:bg-zinc-950/20" id="chatlog-container">
<div class="flex flex-col gap-1 max-w-[85%]">
<div class="chat-bubble-ai">
<p class="font-medium text-zinc-700 dark:text-zinc-200">Hello John! I'm your OCBC AI Assistant. How can I help you with your banking today?</p>
</div>
<span class="text-[10px] text-zinc-400 font-medium ml-1">10:30 AM</span>
</div>
<div class="flex flex-col gap-2 mt-2">
<p class="text-[11px] font-bold text-zinc-400 uppercase tracking-wider ml-1">Suggested Actions</p>
<button class="chat-suggestion flex items-center gap-2">
<span class="material-symbols-outlined !text-sm">redeem</span>
                    How do I check my rewards?
                </button>
<button class="chat-suggestion flex items-center gap-2">
<span class="material-symbols-outlined !text-sm">receipt</span>
                    Help me pay a bill
                </button>
<button class="chat-suggestion flex items-center gap-2">
<span class="material-symbols-outlined !text-sm">pin</span>
                    Change my card PIN
                </button>
<button class="chat-suggestion flex items-center gap-2">
<span class="material-symbols-outlined !text-sm">language</span>
                    Translate interface to Mandarin
                </button>
</div>
</div>
<div class="p-4 border-t border-zinc-100 dark:border-zinc-800 bg-white dark:bg-zinc-900">
<div class="relative flex items-center">
<input id="chatInput" class="w-full bg-zinc-100 dark:bg-zinc-800 border-none rounded-full py-3 px-5 pr-12 text-sm focus:ring-2 focus:ring-primary/50 transition-all dark:placeholder:text-zinc-500" placeholder="Type a message..." type="text"/>
<button id="chatSendBtn" class="absolute right-2 p-2 bg-primary text-white rounded-full hover:bg-red-700 transition-colors shadow-sm">
<span class="material-symbols-outlined !text-lg">send</span>
</button>
</div>
<p class="text-[10px] text-zinc-400 text-center mt-3 flex items-center justify-center gap-1">
<span class="material-symbols-outlined !text-[12px]">security</span>
                Private &amp; Secure Conversation
            </p>
</div>
</aside>
</main>
<footer class="w-full py-6 mt-auto bg-zinc-100 dark:bg-zinc-950/50 px-6">
<div class="max-w-[1400px] mx-auto flex flex-col md:flex-row items-center justify-between gap-4 text-zinc-500 dark:text-zinc-500 text-xs font-medium">
<div class="flex items-center gap-2">
<span class="material-symbols-outlined !text-sm">security</span>
<span>Your session is secure and encrypted. Please do not share your PIN.</span>
</div>
<div class="flex gap-6">
<a class="hover:text-primary transition-colors" href="#">Privacy Policy</a>
<a class="hover:text-primary transition-colors" href="#">Terms of Use</a>
<span>Â© 2024 OCBC Bank</span>
</div>
</div>
</footer>

</body>

<script>
// AI Chatbot Integration with Support System
let sessionId = null;
let eventSource = null;

async function initChatSession() {
  try {
    const response = await fetch('/support/start', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name: 'OCBC Customer', initialMessage: '' })
    });
    const data = await response.json();
    if (data.success) {
      sessionId = data.sessionId;
      setupEventStream();
    }
  } catch (error) {
    console.error('Failed to start chat session:', error);
  }
}

function setupEventStream() {
  if (eventSource) eventSource.close();
  
  eventSource = new EventSource(`/support/stream/${sessionId}`);
  
  eventSource.addEventListener('message', (event) => {
    try {
      const msg = JSON.parse(event.data);
      if (msg.from !== 'user') {
        displayMessage(msg.from, msg.text);
      }
    } catch (e) {
      console.error('Error parsing message:', e);
    }
  });
  
  eventSource.onerror = () => {
    console.error('EventSource connection closed');
    eventSource.close();
  };
}

function displayMessage(from, text) {
  const chatLog = document.getElementById('chatlog-container');
  if (!chatLog) return;
  
  const messageDiv = document.createElement('div');
  messageDiv.className = from === 'user' 
    ? 'flex justify-end mb-3'
    : 'flex flex-col gap-1 max-w-[85%] mb-3';
  
  if (from === 'user') {
    const bubble = document.createElement('div');
    bubble.className = 'bg-primary text-white rounded-2xl rounded-br-none p-4 text-sm max-w-xs';
    bubble.textContent = text;
    messageDiv.appendChild(bubble);
  } else {
    const bubble = document.createElement('div');
    bubble.className = 'chat-bubble-ai';
    bubble.innerHTML = `<p class="font-medium text-zinc-700 dark:text-zinc-200">${escapeHtml(text)}</p>`;
    messageDiv.appendChild(bubble);
    
    const timestamp = document.createElement('span');
    timestamp.className = 'text-[10px] text-zinc-400 font-medium ml-1';
    timestamp.textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    messageDiv.appendChild(timestamp);
  }
  
  chatLog.appendChild(messageDiv);
  chatLog.parentElement.scrollTop = chatLog.parentElement.scrollHeight;
}

async function sendMessage() {
  const input = document.getElementById('chatInput');
  const message = input.value.trim();
  
  if (!message || !sessionId) return;
  
  // Display user message
  displayMessage('user', message);
  input.value = '';
  
  try {
    await fetch('/support/message', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        sessionId: sessionId,
        from: 'user',
        message: message
      })
    });
  } catch (error) {
    console.error('Failed to send message:', error);
  }
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// Event listeners
document.addEventListener('DOMContentLoaded', () => {
  const chatInput = document.getElementById('chatInput');
  const chatSendBtn = document.getElementById('chatSendBtn');
  const chatLogContainer = document.getElementById('chatlog-container');
  
  if (chatLogContainer) {
    initChatSession();
  }
  
  if (chatInput && chatSendBtn) {
    chatInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendMessage();
    });
    
    chatSendBtn.addEventListener('click', sendMessage);
  }
});
</script>

</html>
